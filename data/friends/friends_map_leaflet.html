<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Neo4j Locations</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    html, body, #map { height: 100%; margin: 0; }
    .popup-name { font-weight: 600; margin-bottom: 4px; }
    .legend {
      position: absolute;
      z-index: 1000;
      bottom: 16px; left: 16px;
      background: white; padding: 8px 10px; border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,.15);
      font: 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    .legend span.badge {
      display: inline-block; padding: 2px 6px; margin-right: 6px; border-radius: 999px; background: #eee;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="">
  </script>

  <script>
    // GeoJSON exported from Neo4j (as a JSON string to keep the file standalone)
    const geojson = `{"type": "FeatureCollection", "features": [{"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.711223, 40.4328]}, "properties": {"name": "Gabriela", "labels": ["Person"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.654654, 40.49017]}, "properties": {"name": "Paula", "labels": ["Person"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.617745, 40.4332]}, "properties": {"name": "Cristina", "labels": ["Person"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.617745, 40.4336]}, "properties": {"name": "Daniel", "labels": ["Person"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.711223, 40.434]}, "properties": {"name": "Javier", "labels": ["Person"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.711223, 40.4344]}, "properties": {"name": "Juan", "labels": ["Person"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.711223, 40.4348]}, "properties": {"name": "Elias", "labels": ["Person"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.711223, 40.4352]}, "properties": {"name": "Iciar", "labels": ["Person"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.711223, 40.4356]}, "properties": {"name": "AdriÃ¡n", "labels": ["Person"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.630539, 40.533873]}, "properties": {"name": "Indra", "labels": ["Company"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.728925, 40.453938]}, "properties": {"name": "CIEMAT", "labels": ["Company"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.690136, 40.549613]}, "properties": {"name": "CBM", "labels": ["Company"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.701249, 40.652321]}, "properties": {"name": "Instagram", "labels": ["Company"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.801249, 40.352321]}, "properties": {"name": "Getronics", "labels": ["Company"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.801249, 40.651321]}, "properties": {"name": "Accenture", "labels": ["Company"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.711223, 40.4336]}, "properties": {"name": "Iria", "labels": ["Person"]}}, {"type": "Feature", "geometry": {"type": "Point", "coordinates": [-3.692355, 40.455022]}, "properties": {"name": "Guillermo", "labels": ["Person"]}}]}`;
    const data = JSON.parse(geojson);

    // Build map
    const map = L.map('map').setView([40.4168, -3.7038], 12);

    // OSM tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Simple icon color by label (first label wins). You can refine this.
    const labelColors = {
      Person: '#2e7d32',
      Company: '#1565c0'
    };

    function circleMarker(feature, latlng) {
      const labels = (feature.properties && feature.properties.labels) || [];
      const primary = labels.length ? labels[0] : 'Other';
      const color = labelColors[primary] || '#6d4c41';
      return L.circleMarker(latlng, {
        radius: 7,
        weight: 2,
        opacity: 1,
        color: color,
        fillOpacity: 0.15,
        fillColor: color
      });
    }

    const layer = L.geoJSON(data, {
      pointToLayer: circleMarker,
      onEachFeature: (feature, layer) => {
        const p = feature.properties || {};
        const name = p.name || 'Unknown';
        const labels = (p.labels || []).join(', ');
        layer.bindPopup(`<div class="popup-name">${name}</div>${labels}`);
      }
    }).addTo(map);

    // Fit bounds if we have features
    try {
      const bounds = layer.getBounds();
      if (bounds.isValid()) {
        map.fitBounds(bounds, { padding: [24, 24] });
      }
    } catch (e) {
      // Fall back to default center/zoom
    }

    // Tiny legend
    const legend = L.control({position: 'bottomleft'});
    legend.onAdd = function() {
      const div = L.DomUtil.create('div', 'legend');
      div.innerHTML = `
        <div><span class="badge" style="background:#2e7d32;"></span>Person</div>
        <div><span class="badge" style="background:#1565c0;"></span>Company</div>
      `;
      return div;
    };
    legend.addTo(map);
  </script>
</body>
</html>
